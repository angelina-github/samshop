<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
    <meta charset="utf-8">
    <title></title>
    <script>
      $(document).ready(function() {
        console.log("This script is working!");
        Stripe.setPublishableKey('pk_test_UzTsy4YZ6cwJ5pF2YqbdZDWk');
        // TODO: write a Stripe token response handler function here
        var tokenResponseHandler = function(status, response) {
          console.log("Response from Stripe token call:");
          console.log(response);
          // TODO: check for any input validation errors
          // TODO: if there are errors, display them at the top of the form
          // TODO: if there are not errors, add the token info to the form as a hidden field
          // TODO: submit the form
        };
        $('#payment-form').submit(function(event) {
        // pause form submission
        event.preventDefault();

        // prevent the user from submitting twice
        // by disabling the submit button
        $("#pay-now").attr('disabled','disabled');

        console.log("Form submission is paused!");

        // TODO: call the createToken function
        Stripe.card.createToken({
          number: $('#card-number').val(),
          cvc: $('#card-cvc').val(),
          exp_month: $('#card-exp-month').val(),
          exp_year: $('#card-exp-year').val(),
          }, tokenResponseHandler);
        });
      });
    </script>
  </head>
  <body>
    <h1> Welcome to The Shopping List Builder!</h1>

    <% @products.each do |product| %>
      <p><input type="radio"
        name= 'productID'
        value= "<%= product['id'] %>"></p>
        <p>ITEM: <%= product['item'] %></p>
        <p>STORE: <%= product['store'] %></p>
        <p>QUANTITY: <%= product['quantity'] %></p>
    <% end %>
    <p id="js-output"> </p>
    <form id="payment-form" action="/pay" method="post">
      <p><input type="text" name="email" placeholder="email"></p>
      <p><input id="card-number" type="text" placeholder="card number"></p>
      <p><input id="card-exp-month" type="text" placeholder="card expiration month"></p>
      <p><input id="card-exp-year" type="text" placeholder="card expiration year"></p>
      <p><input id="card-cvc" type="text" placeholder="card cvc"></p>

      <button id="pay-now" type="submit">Pay now</button>
    </form>
</html>
